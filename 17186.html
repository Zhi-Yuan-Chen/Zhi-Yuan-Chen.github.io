<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>RCNN系列阅读笔记 | 贝尔摩德</title><meta name="author" content="noionion"><meta name="copyright" content="noionion"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="RCNN全称为Region with CNN feature，可以说是利用深度学习进行目标检测的开山之作 其中RCNN可以分为四个步骤：  一张图像生成1K~2K个 候选区域(使用Selective Search方法) 对每个候选区域，使用深度网络 提取特征 特征送入每一类的 SVM  分类器，判别是否属于该类 使用回归器 精细修正候选框位置  Selective Search方法一张图像中可能存"><meta property="og:type" content="article"><meta property="og:title" content="RCNN系列阅读笔记"><meta property="og:url" content="https://noionion.top/17186.html"><meta property="og:site_name" content="贝尔摩德"><meta property="og:description" content="RCNN全称为Region with CNN feature，可以说是利用深度学习进行目标检测的开山之作 其中RCNN可以分为四个步骤：  一张图像生成1K~2K个 候选区域(使用Selective Search方法) 对每个候选区域，使用深度网络 提取特征 特征送入每一类的 SVM  分类器，判别是否属于该类 使用回归器 精细修正候选框位置  Selective Search方法一张图像中可能存"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://s2.loli.net/2023/07/23/FSWD5nCYbsHpPfi.png"><meta property="article:published_time" content="2023-10-28T10:54:37.000Z"><meta property="article:modified_time" content="2023-10-28T10:54:37.000Z"><meta property="article:author" content="noionion"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://s2.loli.net/2023/07/23/FSWD5nCYbsHpPfi.png"><link rel="shortcut icon" href="https://noionion-picture-bed.oss-cn-hangzhou.aliyuncs.com/img/head.jpg"><link rel="canonical" href="https://noionion.top/17186"><link rel="preconnect" href="//cdn1.tianli0.top"><link rel="preconnect" href="//busuanzi.ibruce.info"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdnjs.sourcegcdn.com/ajax/libs/font-awesome/6.1.1/css/all.min.css" media="print" onload='this.media="all"'><script>const GLOBAL_CONFIG={root:"/",algolia:void 0,localSearch:{path:"search.xml",languages:{hits_empty:"找不到您查询的内容：${query}"}},translate:void 0,noticeOutdate:void 0,highlight:{plugin:"highlighjs",highlightCopy:!0,highlightLang:!0},copy:{success:"复制成功",error:"复制错误",noSupport:"浏览器不支持"},relativeDate:{homepage:!1,post:!1},runtime:"天",date_suffix:{just:"刚刚",min:"分钟前",hour:"小时前",day:"天前",month:"个月前"},copyright:void 0,lightbox:"fancybox",Snackbar:void 0,source:{jQuery:"https://cdnjs.sourcegcdn.com/ajax/libs/jquery/3.6.0/jquery.min.js",justifiedGallery:{js:"https://cdnjs.sourcegcdn.com/ajax/libs/justifiedGallery/3.8.1/js/jquery.justifiedGallery.min.js",css:"https://cdnjs.sourcegcdn.com/ajax/libs/justifiedGallery/3.8.1/css/justifiedGallery.min.css"},fancybox:{js:"https://cdnjs.sourcegcdn.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js",css:"https://cdnjs.sourcegcdn.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css"}},isPhotoFigcaption:!0,islazyload:!1,isanchor:!1}</script><script id="config-diff">var GLOBAL_CONFIG_SITE={isPost:!0,isHome:!1,isHighlightShrink:!1,isToc:!0,postUpdate:"2023-10-28 18:54:37"}</script><noscript><style type="text/css">#nav{opacity:1}.justified-gallery img{opacity:1}#post-meta time,#recent-posts time{display:inline!important}</style></noscript><script>(e=>{e.saveToLocal={set:function(e,t,o){0!==o&&(o=864e5*o,t={value:t,expiry:(new Date).getTime()+o},localStorage.setItem(e,JSON.stringify(t)))},get:function(e){var t=localStorage.getItem(e);if(t){t=JSON.parse(t);if(!((new Date).getTime()>t.expiry))return t.value;localStorage.removeItem(e)}}},e.getScript=a=>new Promise((t,e)=>{const o=document.createElement("script");o.src=a,o.async=!0,o.onerror=e,o.onload=o.onreadystatechange=function(){var e=this.readyState;e&&"loaded"!==e&&"complete"!==e||(o.onload=o.onreadystatechange=null,t())},document.head.appendChild(o)}),e.activateDarkMode=function(){document.documentElement.setAttribute("data-theme","dark"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#0d0d0d")},e.activateLightMode=function(){document.documentElement.setAttribute("data-theme","light"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#ffffff")};e=saveToLocal.get("theme");"dark"===e?activateDarkMode():"light"===e&&activateLightMode()})(window)</script><link rel="stylesheet" href="https://cdn1.tianli0.top/npm/lxgw-wenkai-screen-webfont@1.1.0/style.css"><script charset="UTF-8" id="LA_COLLECT" src="//sdk.51.la/js-sdk-pro.min.js"></script><script>LA.init({id:"Jws8lO85zPmXkSKj",ck:"Jws8lO85zPmXkSKj"})</script><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-footer-beautify@1.0.0/lib/runtime.css" media="print" onload='this.media="all"'><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper.min.css" media="print" onload='this.media="all"'><meta name="generator" content="Hexo 5.3.0"><link rel="alternate" href="/atom.xml" title="贝尔摩德" type="application/atom+xml"><link rel="alternate" href="/rss.xml" title="贝尔摩德" type="application/rss+xml"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="simply-cha-top"></div><div class="is-center" id="sidebar-avatar"><div class="avatar-img"><img src="https://noionion-picture-bed.oss-cn-hangzhou.aliyuncs.com/img/head.jpg" onerror='this.onerror=null,this.src="/img/friend_404.gif"' alt="avatar"></div><div class="author-info__name">noionion</div><div class="author-info__description">欢迎光临！</div></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">文章</div><div class="length-num">12</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">标签</div><div class="length-num">5</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">分类</div><div class="length-num">4</div></a></div></div></div><a class="button--animated" id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/2X-ercha"><i class="fab fa-github"></i><span> Follow Me</span></a><div class="menu-info-social-icons is-center"><a class="social-icon" href="https://github.com/Zhi-Yuan-Chen" target="_blank" title="Github"><i class="fa-fw fab fa-github"></i></a><a class="social-icon" href="mailto:noionion@outlook.com" target="_blank" title="Email"><i class="fa-fw fas fa-envelope"></i></a><a class="social-icon" href="/rss.xml" target="_blank" title="rss"><i class="fa-fw fas fa-rss"></i></a></div><hr><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-xigua1"></use></svg><span>甜瓜待摘</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child" style="left:-45px"><li><a class="site-page child" href="/tags/Course/"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-jiaocheng"></use></svg><span>教程分享</span></a></li><li><a class="site-page child" href="/tags/Project/"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-xiangmu"></use></svg><span>自制项目</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-miao"></use></svg><span>种瓜日记</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child" style="left:-100px"><li><a class="site-page child" href="/tags/C/"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-colorful-code"></use></svg><span>搓搓C++</span></a></li><li><a class="site-page child" href="/tags/Python/"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-colorful-code"></use></svg><span>玩玩爬虫</span></a></li><li><a class="site-page child" href="/tags/html/"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-colorful-code"></use></svg><span>摸摸前端</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-tea"></use></svg><span>生活日常</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child" style="left:-100px"><li><a class="site-page child" href="/link/"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-pengyou"></use></svg><span>友情链接</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://memos.noionion.cn/"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-pengyouquanzhushou2x"></use></svg><span>随便说说</span></a></li><li><a class="site-page child" href="/messageboard/"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-shuoshuo-"></use></svg><span>留言信箱</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-liuyan"></use></svg><span>猹的哔哔</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child" style="left:-45px"><li><a class="site-page child" href="/tags/Diary/"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-tubiaozhizuomoban-"></use></svg><span>贰猹随笔</span></a></li><li><a class="site-page child" href="/about/"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-xinfeng"></use></svg><span>猹的自述</span></a></li></ul></div></div><div class="simply-cha"></div></div></div><div class="post" id="body-wrap"><header class="not-top-img" id="page-header"><nav id="nav"><div id="nav-group"><span id="blog_name"><a id="site-name" href="/">贝尔摩德</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-xigua1"></use></svg><span>甜瓜待摘</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child" style="left:-45px"><li><a class="site-page child" href="/tags/Course/"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-jiaocheng"></use></svg><span>教程分享</span></a></li><li><a class="site-page child" href="/tags/Project/"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-xiangmu"></use></svg><span>自制项目</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-miao"></use></svg><span>种瓜日记</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child" style="left:-100px"><li><a class="site-page child" href="/tags/C/"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-colorful-code"></use></svg><span>搓搓C++</span></a></li><li><a class="site-page child" href="/tags/Python/"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-colorful-code"></use></svg><span>玩玩爬虫</span></a></li><li><a class="site-page child" href="/tags/html/"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-colorful-code"></use></svg><span>摸摸前端</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-tea"></use></svg><span>生活日常</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child" style="left:-100px"><li><a class="site-page child" href="/link/"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-pengyou"></use></svg><span>友情链接</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://memos.noionion.cn/"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-pengyouquanzhushou2x"></use></svg><span>随便说说</span></a></li><li><a class="site-page child" href="/messageboard/"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-shuoshuo-"></use></svg><span>留言信箱</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-liuyan"></use></svg><span>猹的哔哔</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child" style="left:-45px"><li><a class="site-page child" href="/tags/Diary/"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-tubiaozhizuomoban-"></use></svg><span>贰猹随笔</span></a></li><li><a class="site-page child" href="/about/"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-xinfeng"></use></svg><span>猹的自述</span></a></li></ul></div></div></div><div id="navFn"><div id="search-button"><a class="social-icon search"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-sousuo"></use></svg><span>搜索</span></a></div><div id="darkmodeBt"><a class="darkmode switch"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-deng1"></use></svg><span id="darkmode-switch">关灯</span></a></div><div id="toggle-menu"><a class="site-page"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-mulu"></use></svg></a></div></div></div></nav></header><div id="mainbody"><div id="content_leftside"><div id="left_menu"><div class="leftside-social"><a class="social-icon" href="https://github.com/Zhi-Yuan-Chen" target="_blank" title="Github"><i class="fa-fw fab fa-github"></i></a><a class="social-icon" href="mailto:noionion@outlook.com" target="_blank" title="Email"><i class="fa-fw fas fa-envelope"></i></a><a class="social-icon" href="/rss.xml" target="_blank" title="rss"><i class="fa-fw fas fa-rss"></i></a></div><div class="leftside-contents"><span id="read-percent">0</span></div><div class="leftside-comment"><a href="#post-comment" title="要去留言吗？"><i class="fa-lg fas fa-comment"></i></a></div><div class="leftside-qq" title="来糖果屋聊天噻！"><i class="fa-lg fas fa-qrcode"></i></div><div class="leftside-rmb"><a title="柿还在施工的捐赠页！不给看！"><i class="fa-lg fas fa-money-check-dollar"></i></a></div></div><div id="left_display"><div class="candy_qrcode"><img src="./img/candy-qr.png"></div></div></div><main class="layout hide-aside" id="content-inner"><div id="post"><div id="post-info"><h1 class="post-title">RCNN系列阅读笔记</h1><div id="post-meta"><div class="tag-cloud-list is-center"></div><div class="meta-firstline"><span class="post-meta-date"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-rili"></use></svg><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-10-28T10:54:37.000Z" title="发表于 2023-10-28 18:54:37">2023-10-28</time><span class="post-meta-separator">|</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-shijian"></use></svg><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-10-28T10:54:37.000Z" title="更新于 2023-10-28 18:54:37">2023-10-28</time></span></div><div class="meta-secondline"><span class="post-meta-separator"></span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">2.3k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>8分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" data-flag-title="RCNN系列阅读笔记"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div><div class="line"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-xigua2"></use></svg><svg class="icon" aria-hidden="true"><use xlink:href="#icon-xigua2"></use></svg><svg class="icon" aria-hidden="true"><use xlink:href="#icon-xigua2"></use></svg><svg class="icon" aria-hidden="true"><use xlink:href="#icon-xigua2"></use></svg><svg class="icon" aria-hidden="true"><use xlink:href="#icon-xigua2"></use></svg></div></div></div><article class="post-content" id="article-container"><h2 id="RCNN"><a href="#RCNN" class="headerlink" title="RCNN"></a>RCNN</h2><p>全称为<strong>Region with CNN feature</strong>，可以说是利用深度学习进行目标检测的开山之作</p><p>其中RCNN可以分为四个步骤：</p><ul><li>一张图像生成1K~2K个 候选区域(使用Selective Search方法)</li><li>对每个候选区域，使用深度网络 提取特征</li><li>特征送入每一类的 SVM 分类器，判别是否属于该类</li><li>使用回归器 精细修正候选框位置</li></ul><h4 id="Selective-Search方法"><a href="#Selective-Search方法" class="headerlink" title="Selective Search方法"></a>Selective Search方法</h4><p>一张图像中可能存在多个物体需要分别定位和分类。显然，在训练分类器之前，需要使用一些方法将图像划分为小的区域，这些方法统称为Region Proposal，而Selective Search就是其中一种方法，而该算法主要分为两个内容：Hierarchical Grouping Algorithm、Diversification Strategies</p><p>ⅠHierarchical Grouping Algorithm</p><p>图像中区域特征比像素更具代表性，首先使用<strong>Felzenszwalb and Huttenlocher</strong>的方法产生图像初始区域，使用贪心算法对区域进行迭代分组。</p><p>算法的步骤如下：</p><ol><li>计算所有邻近区域之间的相似性；</li><li>两个最相似的区域被组合在一起；</li><li>计算合并区域和相邻区域的相似度；</li><li>重复2、3过程，直到整个图像变为一个地区。</li></ol><p>Ⅱ Diversification Strategies</p><p>这个方法就是计算相似度的，主要从四个方面进行展开考虑，包括颜色相似度、纹理相似度、尺度相似度、填充相似度，然后用一个复杂的公式计算。没啥意义，不罗列了</p><h4 id="深度网络提取特征"><a href="#深度网络提取特征" class="headerlink" title="深度网络提取特征"></a>深度网络提取特征</h4><p>首先将2k个候选区域缩放成<code>227*227</code>的pixel，然后将候选区域输入事先训练好的<code>AlexNet CNN</code>网络获取4096维的特征得到<code>2000×4096</code>维矩阵(每行一个候选区域)</p><h4 id="特征送入每一类的-SVM-分类器"><a href="#特征送入每一类的-SVM-分类器" class="headerlink" title="特征送入每一类的 SVM  分类器"></a>特征送入每一类的 SVM 分类器</h4><p>将<code>2000×4096</code>维特征与20个SVM组成的权值矩阵<code>4096×20</code>相乘，获得2000×20维矩阵表示每个建议框是某个目标类别的得分。分别对上述2000×20维矩阵中每一列即每一类进行 <strong>非极大值抑制</strong>剔除重叠建议框，得到该列即该类中得分最高的一些建议框。</p><blockquote><p>非极大值抑制：</p><p>非极大值抑制，简称为NMS算法，英文为Non-Maximum Suppression。其思想是搜素局部最大值，抑制非极大值。目标检测的过程中在同一目标的位置上会产生大量的候选框，这些候选框相互之间可能会有重叠，此时我们需要利用非极大值抑制找到最佳的目标边界框，消除冗余的边界框。</p><p><strong>前提：</strong>目标边界框列表及其对应的置信度得分列表，设定阈值，阈值用来删除重叠较大的边界框。</p><p><strong>IoU</strong>：intersection-over-union，即两个边界框的交集部分除以它们的并集。</p><p>流程如下：</p><ul><li>根据置信度得分进行排序</li><li>选择置信度最高的比边界框添加到最终输出列表中，将其从边界框列表中删除</li><li>计算所有边界框的面积</li><li>计算置信度最高的边界框与其它候选框的IoU</li><li>删除IoU大于阈值的边界框</li><li>重复上述过程，直至边界框列表为空</li></ul></blockquote><h4 id="使用回归器-精细修正候选框位置"><a href="#使用回归器-精细修正候选框位置" class="headerlink" title="使用回归器 精细修正候选框位置"></a>使用回归器 精细修正候选框位置</h4><p>对NMS处理后剩余的建议框进一步筛选。接着分别用20个回归器对上述20个类别中剩余的建议框进行回归操作，最终得到每个类别的修正后的得分最高的bounding box。</p><h4 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h4><ul><li>测试速度慢</li><li>训练所需空间大</li></ul><h2 id="fast-RCNN"><a href="#fast-RCNN" class="headerlink" title="fast-RCNN"></a>fast-RCNN</h2><h4 id="网络结构"><a href="#网络结构" class="headerlink" title="网络结构"></a>网络结构</h4><p>可以分为三个步骤：</p><ul><li>一张图像生成1K~2K个 候选区域(使用Selective Search方法)</li><li>将图像输入网络得到相应的 特征图，将SS算法生成的候选框投影到特征图上获得相应的 特征矩阵</li><li>将每个特征矩阵通过ROI pooling层缩放到 7x7 大小的特征图，接着将特征图展平通过一系列全连接层得到预测结果</li></ul><p>结构如下：</p><p><img src="https://s2.loli.net/2023/10/26/RsfuCQqZbVmWknO.png" alt="fastRCNN.png"></p><p>相比于<code>RCNN</code>，Fast-RCNN将整张图像送入网络，紧接着从特征图像上提取相应的候选区域，这些候选区域的特征 不需要再重复计算</p><p>在微调过程中，采用小批量采样，每个SGD小批量由N = 2个图像构成，这些图像是均匀随机选择的。使用大小为R = 128的小批量，从每个图像中采样64个RoIs。</p><p><code>RoI pooling</code>是一个广泛应用在目标检测任务的卷积神经网络中的操作。它的目的是对不规范的输入进行max pooling，以获得固定尺寸的feature maps（例如7×7）。</p><h4 id="分类器和边界框回归器"><a href="#分类器和边界框回归器" class="headerlink" title="分类器和边界框回归器"></a>分类器和边界框回归器</h4><p>分类器(也就是上图的softmax对应的分类器)输出N+1个类别的概率（N为检测目标的种类, 1为背景）共N+1个节点</p><p>边界框回归器输出对应N+1个类别的候选边界框回归参数($d_x,d_y,d_w,d_h$),共$(N+1)\times4$个节点</p><p>然后可以计算：</p><p>$\begin{aligned}<br>&amp;\hat{G}<em>x=P_wd_x(P)+P_x \<br>&amp;\hat{G}_y=P_hd_y(P)+P_y \<br>&amp;\hat{G}_{w}=P</em>{w}\exp(d_{w}(P)) \<br>&amp;\begin{aligned}\hat{G}_h=P_h\exp(d_h(P))\end{aligned}<br>\end{aligned}$</p><p>其中，$P_x,P_y,P_w,P_h$分别为候选框的中心x，y坐标，以及宽高</p><p>$\hat{G}_x,\hat{G}_y,\hat{G}_w,\hat{G}_h$分别为最终预测的边界框中心x，y坐标，以及宽高</p><h4 id="损失函数"><a href="#损失函数" class="headerlink" title="损失函数"></a>损失函数</h4><p>Multi-task loss：</p><p>$L(p,u,t^u,v)=L_{cls}(p,u)+\lambda[u\geq1]L_{loc}(t^u,v)$</p><p>$p$是分类器预测的softmax概率分布$p=(p_0,p_1,···,p_k)$,$u$对应目标真实类别标签</p><p>①分类损失$L_{cls}\left(p,u\right)=-\log p_{u}$</p><p>②边界框回归损失$\lambda[u\geq1]L_{loc}(t^u,v)$中的$[u\geq1]$是艾弗森括号</p><p>$t^u$对应边界框回归器预测的对应类别$u$的回归参数$\left(t_x^u,t_y^u,t_w^u,t_h^u\right)$</p><p>$v$对应真实目标的边界框回归参数$\left(\nu_{x},\nu_{y},\nu_{w},\nu_{h}\right)$</p><p>$L_{loc}(t^u,\nu)=\sum_{i\in{x,y,w,h}}smooth_{L_1}(t_i^u-\nu_i)$</p><p>其中$$smooth_{L_1}(x)=\begin{cases}0.5x^2&amp;\quad\text{if}|x|&lt;1\|x|-0.5&amp;\quad\text{otherwise}\end{cases}$$</p><h2 id="Faster-RCNN"><a href="#Faster-RCNN" class="headerlink" title="Faster-RCNN"></a>Faster-RCNN</h2><h4 id="网络结构-1"><a href="#网络结构-1" class="headerlink" title="网络结构"></a>网络结构</h4><p>Faster-RCNN可以理解为$RPN+Fast R-CNN$</p><p>可以分为三个步骤：</p><ul><li>将图像输入网络得到相应的特征图</li><li>使用RPN结构生成候选框，将RPN生成的候选框投影到特征图上获得相应的特征矩阵</li><li>将每个特征矩阵通过ROI pooling层缩放到7x7大小的特征图，接着将特征图展平通过一系列全连接层得到预测结果</li></ul><p>网络结构图如下所示：</p><p><img src="https://s2.loli.net/2023/10/26/xzQnFKHPXtyi3No.png" alt="faster-RCNN.png"></p><h4 id="RPN"><a href="#RPN" class="headerlink" title="RPN"></a>RPN</h4><p>对于特征图上的每个3x3的滑动窗口，计算出滑动窗口中心点对应原始图像上的中心点，并计算出k个anchor boxes</p><p>如果使用的是<code>VGG16 net</code>，则滑动窗口维度(<code>channel</code>)为512，如果使用的是<code>ZF Net</code>,则滑动窗口维度为256</p><p>这$k$个anchor，对于<code>cls layer</code>需要输出<code>2k</code>个score；对于<code>reg layer</code>，需要输出<code>4k</code>个score</p><p>1、这$k$个anchor box如何产生？</p><p>使用$128\times128$,$256\times256$,$512\times512$三个规模的box area，并且有3个长宽比，分别为1:1、1:2和2:1，每个位置在原图上都对应有$3\times3$个anchor</p><p>2、训练数据如何采样？</p><p>采用了“以图像为中心”的采样策略来训练这个网络，每个小批量数据都来自于包含许多正负样本锚框的单个图像。虽然可以优化所有锚框的损失函数，但这会对负样本产生偏向，因为它们数量占主导地位。相反，我们在一个图像中随机采样256个锚框来计算一个小批量的损失函数，其中采样的正负样本锚框的比例最多为1:1。如果一个图像中的正样本少于128个，我们会用负样本填充小批量数据。</p><h4 id="RPN-Multi-task-loss"><a href="#RPN-Multi-task-loss" class="headerlink" title="RPN-Multi-task loss"></a>RPN-Multi-task loss</h4><p>$L\left( \left{ p_i \right} ,\left{ t_i \right} \right) =\frac{1}{N_{cls}}\sum_i^{}{L_{cls}\left( p_i,p_{i}^{<em>} \right)}+\lambda \frac{1}{N_{reg}}\sum_i^{}{p_{i}^{</em>}L_{reg}\left( t_i,t_{i}^{*} \right)}$</p><p>其中，前半部分为<code>分类损失</code>，后半部分为<code>边界框回归损失</code>。</p><p>①参数解释：</p><p>$p_i$表示第$i$个anchor预测为真实标签的概率</p><p>$p_{i}^{*}$当为正样本时为1，为负样本时为0。</p><p>$t_i$表示预测第$i$个anchor的边界框回归参数</p><p>$t_{i}^{*}$表示第$i$个anchor对应的GTBOX的边界框回归参数</p><p>$N_{cls}$表示一个<code>mini-batch</code>里面的所有样本数量为256</p><p>$N_{reg}$表示anchor位置的个数(不是anchor个数)约2400</p><p>②公式解释：</p><p>$L_{cls}=-log(p_i)$，其实就是cross entropy</p><p>$L_{reg}\left( t_i,t_{i}^{<em>} \right) =\sum_i^{}{smooth_{L_1}\left( t_i-t_{i}^{</em>} \right)}$</p><p>其中$t_i=\left[ t_x,t_y,t_w,t_h \right] ,t_{i}^{<em>}=\left[ t_{x}^{</em>},t_{y}^{<em>},t_{w}^{</em>},t_{h}^{*} \right]$</p><h4 id="Faster-R-CNN"><a href="#Faster-R-CNN" class="headerlink" title="Faster R-CNN"></a>Faster R-CNN</h4><p>直接采用RPN Loss+ Fast R-CNN Loss的联合训练方法，这个好像tensorflow已经实现了，所以这里就不再赘述</p></article><div class="tag_share"><div class="post-meta__tag-list"></div><div class="post_share"><div class="social-share" data-image="https://s2.loli.net/2023/07/23/FSWD5nCYbsHpPfi.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdnjs.sourcegcdn.com/ajax/libs/social-share.js/1.0.16/css/share.min.css" media="print" onload='this.media="all"'><script src="https://cdnjs.sourcegcdn.com/ajax/libs/social-share.js/1.0.16/js/social-share.min.js" defer></script></div></div><div class="end is-center">end</div><div class="line is-center"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-xigua2"></use></svg><svg class="icon" aria-hidden="true"><use xlink:href="#icon-xigua2"></use></svg><svg class="icon" aria-hidden="true"><use xlink:href="#icon-xigua2"></use></svg><svg class="icon" aria-hidden="true"><use xlink:href="#icon-xigua2"></use></svg><svg class="icon" aria-hidden="true"><use xlink:href="#icon-xigua2"></use></svg></div><div id="post-comment"><div class="comment-head is-center"><div class="comment-headline"><span>欢迎留言</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div></div></main><div id="content_rightside"><div id="rightside-toc"><div class="toc-box"><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#RCNN"><span class="toc-text">RCNN</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Selective-Search%E6%96%B9%E6%B3%95"><span class="toc-text">Selective Search方法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B7%B1%E5%BA%A6%E7%BD%91%E7%BB%9C%E6%8F%90%E5%8F%96%E7%89%B9%E5%BE%81"><span class="toc-text">深度网络提取特征</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%89%B9%E5%BE%81%E9%80%81%E5%85%A5%E6%AF%8F%E4%B8%80%E7%B1%BB%E7%9A%84-SVM-%E5%88%86%E7%B1%BB%E5%99%A8"><span class="toc-text">特征送入每一类的 SVM 分类器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%9B%9E%E5%BD%92%E5%99%A8-%E7%B2%BE%E7%BB%86%E4%BF%AE%E6%AD%A3%E5%80%99%E9%80%89%E6%A1%86%E4%BD%8D%E7%BD%AE"><span class="toc-text">使用回归器 精细修正候选框位置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BC%BA%E7%82%B9"><span class="toc-text">缺点</span></a></li></ol></li></ol><li class="toc-item toc-level-2"><a class="toc-link" href="#fast-RCNN"><span class="toc-text">fast-RCNN</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E7%BB%93%E6%9E%84"><span class="toc-text">网络结构</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%86%E7%B1%BB%E5%99%A8%E5%92%8C%E8%BE%B9%E7%95%8C%E6%A1%86%E5%9B%9E%E5%BD%92%E5%99%A8"><span class="toc-text">分类器和边界框回归器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8D%9F%E5%A4%B1%E5%87%BD%E6%95%B0"><span class="toc-text">损失函数</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Faster-RCNN"><span class="toc-text">Faster-RCNN</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E7%BB%93%E6%9E%84-1"><span class="toc-text">网络结构</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#RPN"><span class="toc-text">RPN</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#RPN-Multi-task-loss"><span class="toc-text">RPN-Multi-task loss</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Faster-R-CNN"><span class="toc-text">Faster R-CNN</span></a></li></ol></li></div></div></div><div id="rightside-button"><button id="rightside-go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div></div><footer id="footer"><div class="wordcount"><span>猹居然写了 53.2k 字</span><br><span>好像写完一本 埃克苏佩里 的 《小王子》 了啊</span></div><div class="footer-content"><a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span style="padding:.4rem">hexo</span></a><a><i class="fas fa-heart"></i></a><a href="https://butterfly.js.org/" target="_blank" rel="nofollow noopener"><span style="padding:.4rem">butterfly</span></a><div style="font-size:.7rem"><span id="timeDate">载入天数...</span><span> </span><span id="times">载入时分秒...</span><script src="/js/add/duration.js"></script></div></div><div class="statistics"><span id="site_uv">有 <span id="busuanzi_value_site_uv"></span><span> 人光顾过猹的小窝</span></span><span id="site_pv"><span>共 </span><span id="busuanzi_value_site_pv"></span><span> 次在这里摘了个瓜</span></span></div></footer></div><div id="rightside"></div><div id="local-search"><div class="search-dialog"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"></div></div></div><hr><div id="local-search-results"></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>if(window.MathJax)MathJax.startup.document.state(0),MathJax.texReset(),MathJax.typeset();else{window.MathJax={loader:{source:{"[tex]/amsCd":"[tex]/amscd"}},tex:{inlineMath:[["$","$"],["\\(","\\)"]],tags:"ams"},options:{renderActions:{findScript:[10,t=>{for(const s of document.querySelectorAll('script[type^="math/tex"]')){var e=!!s.type.match(/; *mode=display/),e=new t.options.MathItem(s.textContent,t.inputJax[0],e),a=document.createTextNode("");s.parentNode.replaceChild(a,s),e.start={node:a,delim:"",n:0},e.end={node:a,delim:"",n:0},t.math.push(e)}},""],addClass:[200,()=>{document.querySelectorAll("mjx-container:not([display='true']").forEach(t=>{t=t.parentNode;t.classList.contains("has-jax")||t.classList.add("mathjax-overflow")})},"",!1]}}};const a=document.createElement("script");a.src="https://cdnjs.sourcegcdn.com/ajax/libs/mathjax/3.2.0/es5/tex-mml-chtml.min.js",a.id="MathJax-script",a.async=!0,document.head.appendChild(a)}</script><script>(()=>{const t=document.getElementById("twikoo-count"),n=()=>{let o={el:"#twikoo-wrap",envId:"https://twikoo.noionion.cn",region:""};twikoo.init(o)},e=()=>{twikoo.getCommentsCount({envId:"https://twikoo.noionion.cn",region:"",urls:[window.location.pathname],includeReply:!1}).then(function(o){t.innerText=o[0].count}).catch(function(o){console.error(o)})},o=(o=!1)=>{"object"==typeof twikoo?(n(),o&&t&&setTimeout(e,0)):getScript("https://cdnjs.sourcegcdn.com/ajax/libs/twikoo/1.6.7/twikoo.all.min.js").then(()=>{n(),o&&t&&setTimeout(e,0)})};btf.loadComment(document.getElementById("twikoo-wrap"),o)})()</script></div><script async src="//at.alicdn.com/t/font_2749059_1lswi5j6yqg.js"></script><script src="/js/add/nav.js"></script><script src="/js/add/leftsidemenu.js"></script><script src="https://cdn1.tianli0.top/npm/butterfly-extsrc@1/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful=!0,POWERMODE.shake=!1,POWERMODE.mobile=!1,document.body.addEventListener("input",POWERMODE)</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><script data-pjax>function butterfly_footer_beautify_injector_config(){var e=document.getElementById("footer-wrap");console.log("已挂载butterfly_footer_beautify"),e.insertAdjacentHTML("beforeend",'<div id="ghbdages" style="overflow:hidden;max-height:180px;height:auto;text-align:center;margin-top:10px"><div class="swiper-wrapper"><div class="swiper-slide"><a class="github-badge" target="_blank" href="https://hexo.io/" style="margin-inline:5px" title="博客框架为Hexo_v5.3.0"><img src="https://img.shields.io/badge/Frame-Hexo-blue?style=flat&amp;logo=hexo" alt=""/></a><a class="github-badge" target="_blank" href="https://butterfly.js.org/" style="margin-inline:5px" title="主题版本Butterfly_v3.7.0-b2"><img src="https://img.shields.io/badge/Theme-Butterfly-6513df?style=flat&amp;logo=bitdefender" alt=""/></a><a class="github-badge" target="_blank" href="https://www.sourcegcdn.com/" style="margin-inline:5px" title="本站使用Source Global CDN为部分静态资源提供CDN加速"><img src="https://img.shields.io/badge/CDN-sourcegcdn-orange?style=flat&amp;logo=Apache%20RocketMQ" alt=""/></a><a class="github-badge" target="_blank" href="https://www.jsdelivr.com/" style="margin-inline:5px" title="本站使用JsDelivr仅用于访问部分静态资源"><img src="https://img.shields.io/badge/CDN-jsDelivr-orange?style=flat&amp;logo=jsDelivr" alt=""/></a><a class="github-badge" target="_blank" href="https://github.com/" style="margin-inline:5px" title="本站项目由Github托管"><img src="https://img.shields.io/badge/Source-Github-d021d6?style=flat&amp;logo=GitHub" alt=""/></a><a class="github-badge" target="_blank" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" style="margin-inline:5px" title="本站采用知识共享署名-非商业性使用-相同方式共享4.0国际许可协议进行许可"><img src="https://img.shields.io/badge/Copyright-BY--NC--SA%204.0-d42328?style=flat&amp;logo=Claris" alt=""/></a></div></div></div><style>a.github-badge:hover:before {display:none}</style>')}for(var elist="null".split(","),cpage=location.pathname,epage="all",flag=0,i=0;i<elist.length;i++)cpage.includes(elist[i])&&flag++;("all"===epage&&0==flag||epage===cpage)&&butterfly_footer_beautify_injector_config()</script><script defer src="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper.min.js"></script><script defer data-pjax src="https://npm.elemecdn.com/hexo-butterfly-footer-beautify/lib/swiperbdage_init_js.min.js"></script></body></html>